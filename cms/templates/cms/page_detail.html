{% extends 'base.html' %}

{% block title %}
  {{ page.title }}
{% endblock %}

{% block content %}
  {% if alter_URL %}
    <script>
      history.replaceState(
        null,
        '{{ page.title }}',
        '{{ page.get_absolute_url }}')
    </script>
  {% endif %}

  <header>
    <nav class='breadcrumbs'>
      {% include 'cms/partials/breadcrumbs.html' with breadcrumbs=breadcrumbs %}
    </nav>

    <nav class='auth'>
      {% if request.user.is_staff %}
          <a href="{% url 'cms:add_page' %}?from={{ page.id }}">Add page</a>
      {% endif %}

      {% if request.user.is_authenticated %}
        <a href="{% url 'logout' %}?next={{ page.get_absolute_url }}">Logout</a>
      {% else %}
        <a href="{% url 'login' %}?next={{ page.get_absolute_url }}">Login</a>
      {% endif %}
    </nav>

    <h1>{{ page.title }}</h1>
  </header>

  <main>
    {% include 'cms/partials/sidebar.html' with page=page %}

    <article class='content'>
      <aside class='table-of-contents'>
        {% include 'cms/partials/table_of_contents.html' with blocks=page.blocks.all %}
      </aside>

      {% if request.user.is_staff %}
        <a href="{% url 'cms:add_block' %}?page={{ page.uuid }}">
          Add block here
        </a>
      {% endif %}

      {% for cms_block in page.blocks.all %}
        <section>
          {% if request.user.is_staff %}
            <a href="{% url 'cms:delete_block' pk=cms_block.pk %}">Delete block</a>
          {% endif %}

          {% include cms_block.template_name with cms_block=cms_block %}
        </section>

        {% if request.user.is_staff %}
          <a href="{% url 'cms:add_block' %}?page={{ page.uuid }}&after={{ cms_block.id }}">
            Add block here
          </a>
        {% endif %}
      {% endfor %}
    </article>
  </main>
{% endblock %}
